import { TargetRegion } from './types';

export const GENRE_LIST = [
  "「マンガでわかる」・解説学習系",
  "恋愛・人間ドラマ系",
  "ライフハック・自己成長・教育系",
  "マネー・経済・キャリア系",
  "AI・テクノロジー系（2025年トレンド）",
  "ライト文芸・ストーリー系",
  "実用系・ノウハウ系",
  "ビジネス・起業ストーリー系",
  "実話ベース・ドキュメンタリー系",
  "美容・健康・ライフスタイル系",
  "クリエイター・アート系",
  "パーソナルストーリー・半自伝系",
  "SNS向けショート系",
  "アクション・アドベンチャー",
  "ミーム・ユーモア・風刺",
  "古典文学・名作リメイク",
];

const getRegionContext = (region: TargetRegion) => {
  return region === 'domestic' 
    ? { 
        name: '日本国内', 
        market: '日本国内市場', 
        audience: '日本の読者', 
        crossBorder: '海外（特に英語圏）で流行し始めているが、まだ日本で定着していないトレンドのローカライズを検討してください。',
        admonition: '日本の社会背景（少子高齢化、働き方改革など）を踏まえて分析してください。',
        subjectPrefix: '日本国内では',
        namingPolicy: '現代的で実在感のある日本人のフルネーム（苗字と名前）を設定してください。キラキラネームではなく、その職業や年齢にふさわしい信頼感のある名前（例：佐藤 健斗、小林 芽依など）を選んでください。'
      }
    : { 
        name: '英語圏（特に北米）', 
        market: '英語圏（特に北米）の市場', 
        audience: '英語圏の読者（北米中心）', 
        crossBorder: '「日本の漫画」では一般的だが、英語圏ではまだ未開拓なテーマ（例：特定の専門職やニッチな趣味の教育マンガ "Graphic Guides"）を検討してください。',
        admonition: '重要: 日本独自の概念（偏差値、部活の先輩後輩、新卒一括採用など）は避け、現地の文化背景（GPA、Prom、Internshipなど）やトレンド用語（Gen Z, Millennials, FIRE）の「現地での文脈」に合わせて分析してください。',
        subjectPrefix: '北米・英語圏市場では',
        namingPolicy: '多様な文化的背景（ヒスパニック、アジア、アフリカ系、ヨーロッパ系など）を反映した、現代的な英語圏の名前（First Name + Last Name）を設定してください。Elena, Mateo, Priya, Jordan, Marcus, Kenji などの個性を感じさせる名前を採用してください。'
      };
};

export const getGenreProposalPrompt = (region: TargetRegion) => {
  const ctx = getRegionContext(region);
  return `
あなたは「${ctx.market}専門のマンガトレンドアナリスト」です。
現在の${ctx.market}において、**「急増する需要に対し、決定版となる書籍（マンガ）がまだ存在しない（供給不足）」**ブルーオーシャンなジャンルを5つ特定し、提案してください。

# ターゲット市場と分析方針
- **対象市場**: ${ctx.market}
- **文脈**: ${ctx.admonition}

# 出力形式の厳守事項（重要）
- **冒頭の挨拶は一切不要です。** いきなり1つ目の提案から書き始めてください。
- 5つのジャンルを提案してください。
- 各ジャンルの間には、必ず **\`---SECTION_SPLIT---\`** を入れてください。

# 出力フォーマット
1. **ジャンル名**：【概要】...【市場分析】${ctx.subjectPrefix}...
---SECTION_SPLIT---
...
`;
};

export const getTopicProposalPrompt = (genre: string, keyword: string | undefined, region: TargetRegion) => {
  const ctx = getRegionContext(region);
  const inputCase = keyword ? 'Case A（特定テーマの解説本作成）' : 'Case B（トレンドからの市場発掘）';

  const isPractical = genre.includes("マンガでわかる") || genre.includes("学習") || genre.includes("ビジネス") || genre.includes("ノウハウ") || genre.includes("マネー") || genre.includes("AI");
  
  const targetRanking = isPractical 
    ? "「実用・ビジネス・自己啓発・コンピュータ」カテゴリー" 
    : "「マンガ・ライトノベル・文芸」カテゴリー";

  const keywordConstraint = keyword 
    ? `\n# 最優先事項：指定テーマの解説本化（「○○がよくわかる本」形式）
ユーザーは**「${keyword}」について徹底解説する書籍（マンガでわかる○○、○○がよくわかる本、○○入門など）**を作りたいと考えています。

## 企画の絶対条件:
1. **タイトルの固定**: 提案する5つの企画のうち、3つ以上は必ず「マンガでわかる ${keyword}」または「${keyword}がよくわかる本」という形式にしてください。
2. **実在ツールの正しい扱い**: 実在ツール（Gemini 3.0, Manus等）は「実用的な武器」として扱い、具体的な活用ノウハウを含めてください。
3. **シチュエーションの反映**: キーワード内に主人公の属性がある場合、必ずその人物を主人公に据えてください。`
    : "";

  return `
あなたは「グローバル・ベストセラー・プロデューサー」です。
Gemini 3.0の推論力を駆使し、以下の条件下で「勝率の高い」マンガ企画を5つ提案してください。

# 最重要：出力言語
**すべての企画案は必ず日本語で記述してください。**
- タイトル、コンセプト、ターゲット読者、主要要素など、すべての内容を日本語で出力してください。
- ターゲット市場が英語圏であっても、企画案の説明文は日本語で記述してください。
- 英語圏市場向けの企画であっても、企画案の説明は日本語で行い、市場分析のみ英語圏の文脈を考慮してください。

# 前提条件
- **Trend (ジャンル)**: ${genre}
- **Target Market**: ${ctx.market}
${keywordConstraint}

# 出力形式
- 各提案の間に **\`---SECTION_SPLIT---\`** を入れてください。
- 冒頭の挨拶は不要です。
- 各企画案は以下の形式で日本語で記述してください：
  - タイトル（日本語）
  - コンセプト（日本語）
  - ターゲット読者（日本語）
  - 主要要素（日本語）
`;
};

export const getConceptPrompt = (topic: string, region: TargetRegion) => {
  const ctx = getRegionContext(region);
  return `
Role: あなたは「グローバル・ベストセラー・プロデューサー」兼「超高密度カリキュラム設計の専門家」です。
Gemini 3.0の能力を駆使し、シリーズ累計100万部を狙える「勝てるマンガ解説本」の全5巻構成案を作成します。

# 対象テーマ
${topic}

# Target Market
- ${ctx.market}
- ${ctx.admonition}

# キャラクター・ネーミング方針（厳守）
- **名前の多様性**: ${ctx.namingPolicy}
- **禁止事項**: **「Alex (アレックス)」という名前は、AIが生成しがちなありふれた名前であるため、今回は絶対に使用しないでください。**
- **背景の反映**: 主人公の出身地、家庭環境、現在の職業的地位（インターン、シニア、マネージャー、個人事業主など）が透けて見えるような、意味のあるネーミングを行ってください。

---

### 🧠 Phase 2: High-Density Structuring (超高密度・構成作成)

全5巻分の詳細な構成案を作成してください。

**⚠️ 重要ルール（構成の形式）**
1. **章番号のリセット**: 各巻（Vol.1〜Vol.5）ごとに、章番号を **「Chapter 1」からリセットして** 振り直してください。巻をまたいで通し番号にはしないでください。
2. **黄金の5巻ロードマップ**:
   * **Vol.1 (Beginner):** 最初の成功体験。「今すぐ使える！」
   * **Vol.2 (Fundamental):** 基本原則と挫折の克服。
   * **Vol.3 (World/Structure):** 応用力と構造理解。
   * **Vol.4 (Series/Expansion):** 高度な連携・組織への導入。
   * **Vol.5 (Mastery/Biz):** 圧倒的な成果とプロへの到達。

3. **解説と物語のバランス**:
   * 各章で「マンガパート（ストーリー）」と「解説・図解パート（ノウハウ）」の両方を記述してください。

---

### 📝 Output Format (出力形式)

#### ■ 1. 市場分析レポート
* **分析テーマ**: ${topic}
* **勝算の根拠**: (実在ツールの普及度、競合の不在など)

#### ■ 2. シリーズ構成案 (The Master Plan)

**シリーズタイトル**: [確定タイトル]
**コンセプト**: [読者が手にする圧倒的な成果]

---

### 【Vol.1: [サブタイトル]】
**コンセプト**: [この巻のゴール]

**Chapter 1: [章タイトル]**
* **マンガ**: [主人公の名前（${ctx.namingPolicy}に準拠）を使い、あらすじを記述]
* **解説**: [具体的な学習内容]

... (Vol.5まで同様に、各巻Chapter 1から開始)

---

# シリーズマスターシート
レポートの最後に、以下のフォーマットで「シリーズマスターシート」を必ず出力してください。

--- [SERIES MASTER SHEET: START] ---
【基本設定】
- タイトル: [確定タイトル]
- 形式: 学習マンガ（解説パート付き）
- 全体構成: 全5巻

【主人公の詳細設定】
- 名前: [フルネーム（${ctx.namingPolicy}に準拠、アレックスは禁止）]
- 属性: [具体的な職業・立場]
- 性格・背景: [没入感を高めるディテール]
- 現在の悩み: [切実な悩み]

【カリキュラム進行表】
- Vol.1: [タイトル] (Chapter 1-4)
- Vol.2: [タイトル] (Chapter 1-4)
- Vol.3: [タイトル] (Chapter 1-4)
- Vol.4: [タイトル] (Chapter 1-4)
- Vol.5: [タイトル] (Chapter 1-4)
--- [SERIES MASTER SHEET: END] ---
`;
};

export const getMasterSheetOnlyPrompt = (concept: string) => `
あなたは「シリーズ構成作家」です。
以下の企画案を分析し、キャラクター名などが整理された「シリーズマスターシート」のみを出力してください。

# 既存の企画案
${concept}

--- [SERIES MASTER SHEET: START] ---
【基本設定】
- タイトル: [企画案から抽出]
- 形式: 解説学習マンガ
- 全体構成: 全5巻

【主人公の現在地 (Start)】
- 名前: [名前（企画案から抽出）]
- 属性: [職業・役割]
- 習得レベル: 初期状態
- 現在の悩み/課題: [課題]

【カリキュラム進行表】
- Vol.1: [タイトル] (Chapter数)
- Vol.2: [タイトル] (Chapter数)
- Vol.3: [タイトル] (Chapter数)
- Vol.4: [タイトル] (Chapter数)
- Vol.5: [タイトル] (Chapter数)

【現在の進行度】
- 現在の位置: 0 / 5 (Start)
--- [SERIES MASTER SHEET: END] ---
`;
